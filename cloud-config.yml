#cloud-config

users:
  - name: appuser
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh_authorized_keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDJ6MJ3oZ3F3bTpk6unzfpk8bYybal7Otj4arRZPnRcCxeJXC7fZIh9KEnzUKi2Zb4M+MeDMvrb05eYsNGKfPJ0FFyqkrVKZ7zHaK9QG7urg/REJRdUX8XNIpfwLprxZ1i9aKnjb6my3SEeoHYu0oHQ0N+7cX/zdBqMK0TwDPLQVcS1XD4hyMZwjG98Agy+MKg2Ik1bRpOp25n6u8va34+JklKFm2vEmKMU+2vtrZrAgFJSrf/wUbw42tD6vcKsRocO6wbZPjAB1m5ck8Wqy9e2o7uj7YDW+Rg08xYJMRSffJNOrzCSiBhxd+0ZsO0/6ZWLxSlhUNwnEnCj7Fy/gfYfQ7dUu6OHQr3OLC/QAYq3k2BRu5p/kkKy7rVrlKsIEtoYqsXGFubMNCVeGr1X+lf91akVctV8aExkwqgJZJF95pkms1mSeGv7ajioRxTnWhgq6NMyDgn3TA0DKMwSQxsJmcr/mX9ohPq21EDqr5/lbCc4wfL9asWHEisYlcWdV4k= appuser

bootcmd:
  # install ruby
  - sudo apt update
  - sudo apt install -y ruby-full ruby-bundler build-essential
  # install mongo
  - wget -qO - https://www.mongodb.org/static/pgp/server-4.2.asc | sudo apt-key add -
  - echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu xenial/mongodb-org/4.2 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.2.list
  - sudo apt-get update
  - sudo apt-get install -y mongodb-org
  - sudo systemctl start mongod
  - sudo systemctl enable mongod
  # install reddit
  - cd ~
  - apt install git
  - git clone -b monolith https://github.com/express42/reddit.git
  - cd reddit && bundle install
  - puma -d
